# AI 编码规则索引

本目录包含项目开发过程中所有 AI 助手（Claude Code 等）必须遵守的编码规则和规范。

## 📋 规则文档

### 0. [对话管理和错误分析规范](./CONVERSATION_MANAGEMENT_RULES.md) ⭐ **NEW**
**用途**: 定义对话追踪、错误分析和规范优化的规范

**核心内容**:
- 对话 ID 管理系统
- 用户输入记录机制
- 错误模式分析和分类
- 编码规范优化流程
- Token 使用统计

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)
**状态**: ✅ 已生效（从 2026-01-25 开始）

---

### 1. [文件组织规范](./FILE_ORGANIZATION_RULES.md)
**用途**: 定义项目的文件组织结构和放置规则

**核心内容**:
- 根目录文件限制
- 文档分类规则 (docs/, .kiro/specs/)
- 脚本文件规则 (scripts/)
- 代码组织规则 (lib/)
- 决策树和检查清单

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)

---

### 2. [版本控制与 Tag 管理规范](./VERSION_CONTROL_RULES.md)
**用途**: 定义版本控制、tag 创建和对话记录的规范

**核心内容**:
- 每次对话的记录要求
- Push 前的检查清单
- Tag 创建流程和注释规范
- 版本历史追踪
- 发布文档模板

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)

---

### 3. [版本控制历史](./VERSION_CONTROL_HISTORY.md)
**用途**: 记录所有 tag 创建、push 操作和重要对话的详细历史

**核心内容**:
- 每个版本的详细信息
- 对话记录和操作内容
- Git 提交和修改文件
- 发布文档链接
- 统计信息

**重要性**: ⭐⭐⭐⭐ (追溯依据)

---

### 4. [JSON 配置文件管理规范](./JSON_CONFIG_RULES.md)
**用途**: 定义 JSON 配置文件的创建、编辑和管理规范

**核心内容**:
- 配置文件必须包含的元素
- 强制校验要求
- 默认配置和示例
- Schema 定义规范
- JSON 编辑器使用

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)

---

### 5. [文档命名规范](./DOCUMENTATION_NAMING_RULES.md)
**用途**: 定义项目中所有文档文件的命名规范

**核心内容**:
- 三种命名风格（kebab-case, UPPERCASE_CASE, snake_case）
- 各目录的命名规范
- 版本号命名规范
- 禁止的命名方式
- 批量重命名清单

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)

---

### 6. [插件配置规范](./PLUGIN_CONFIG_SPEC.md)
**用途**: 定义插件配置功能的强制规范

**核心内容**:
- 强制的文件结构
- 配置文件模板
- 最小可用配置要求
- 配置功能检查清单

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)

---

### 7. [插件配置页面开发规范](./PLUGIN_SETTINGS_SCREEN_RULES.md)
**用途**: 定义插件配置页面的开发标准和最佳实践

**核心内容**:
- 统一的架构模式
- 实时保存原则
- UI 组件使用规范
- 国际化要求
- 配置页面检查清单

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)

---

### 8. [代码风格规范](./CODE_STYLE_RULES.md)
**用途**: 定义 Dart/Flutter 代码风格规范

**核心内容**:
- 格式化规范（dart format）
- 命名规范（类、函数、变量、常量）
- 注释规范（文档注释、代码注释）
- 代码组织规范（import 顺序、文件结构）
- 代码长度规范（函数、类、参数）
- UI 代码规范
- 最佳实践和禁止事项

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)

---

### 9. [测试规范](./TESTING_RULES.md)
**用途**: 定义测试编写和组织规范

**核心内容**:
- 测试文件组织（unit/widget/integration）
- 测试文件命名规范
- 测试覆盖率要求（≥80%）
- 单元测试规范（AAA 模式）
- Widget 测试规范
- Mock 使用规范
- 测试数据管理
- 测试检查清单

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)

---

### 10. [Git 提交规范](./GIT_COMMIT_RULES.md)
**用途**: 定义 Git 提交信息和版本控制规范

**核心内容**:
- 提交信息格式（约定式提交）
- 提交类型和范围定义
- 提交粒度规范
- 提交信息语言规范
- Git 工作流和分支策略
- 代码审查规范
- 提交检查清单

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)

---

### 11. [错误处理规范](./ERROR_HANDLING_RULES.md)
**用途**: 定义错误处理和异常规范

**核心内容**:
- 异常类型使用规范
- 输入验证规范
- 异步错误处理
- 用户错误提示规范
- 错误日志规范
- 错误恢复策略（重试、降级）
- 禁止的错误处理方式
- 错误处理检查清单

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)

---

### 12. [性能优化规范](./PERFORMANCE_OPTIMIZATION_RULES.md)
**用途**: 定义 Flutter 性能优化的核心原则和最佳实践

**核心内容**:
- **性能优先原则**: 性能优先于复杂度
- **Widget 性能优化**: Listener vs GestureDetector, ValueNotifier vs setState
- **状态管理优化**: ValueNotifier/Stream/setState 选择指南
- **渲染性能优化**: RepaintBoundary, ListView.builder, Opacity 优化
- **异步优化**: Isolate, compute, 避免阻塞主线程
- **性能检测**: Flutter DevTools, 性能覆盖层
- **性能优化案例**: Desktop Pet Widget 优化（90% 性能提升）

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)
**关键原则**: **宁可代码复杂一点，也要保证性能最优**

---

### 13. [配置响应式管理规范](./REACTIVE_CONFIG_RULES.md) ⭐ **NEW**
**用途**: 定义配置响应式管理的核心原则和实现模式

**核心内容**:
- **实时生效原则**: 配置修改必须立即生效，无需重启
- **双向同步原则**: 同时更新 GlobalConfig 和运行时状态
- **响应式通知原则**: 使用 ValueNotifier 通知所有监听者
- **配置类型分类**: UI 样式 / 功能开关 / 窗口 API / 回调开关
- **完整实现模式**: ValueNotifier 模式 / didUpdateWidget 模式 / 双向同步模式
- **常见错误和修复**: 只更新 GlobalConfig、不重启动画控制器等
- **检查清单**: 开发阶段和测试阶段的验证要点

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)
**关键原则**: **配置修改必须立即生效**

---

### 14. [单一配置模式规范](./SINGLE_CONFIG_PATTERN_RULES.md) ⭐ **NEW**
**用途**: 定义插件配置数据管理的单一配置模式

**核心内容**:
- **单一配置键原则**: 每个插件使用单一的配置键存储所有持久化数据
- **配置与临时状态分离**: 配置 vs 数据 vs 临时状态的区别
- **配置键命名规范**: `{plugin_id}_config` 格式
- **配置模型设计**: 继承 `BasePluginSettings`，包含所有持久化数据
- **插件实现模式**: `initialize()`, `_saveConfig()`, `updateSettings()` 模式
- **配置默认值文件**: 完整的配置模板和示例
- **常见错误和修复**: 多键分散存储、持久化临时状态、命名不规范等
- **检查清单**: 配置模型、插件实现、配置默认值文件的验证要点

**重要性**: ⭐⭐⭐⭐⭐ (最高优先级)
**关键原则**: **单一配置键存储所有持久化数据**

## 🎯 使用指南

### 对话开始时
1. 阅读相关的规则文档
2. 确认当前版本和历史记录
3. 了解项目结构和约定

### 对话进行中
1. 遵守文件组织规则
2. 记录所有修改、创建、删除的文件
3. 准备详细的提交信息

### 对话结束时
1. **必须**输出完整的对话总结
2. **必须**列出所有修改的文件
3. **必须**更新 CHANGELOG.md
4. **必须**准备 git 提交信息
5. **必须**更新版本控制历史

### Push 前
1. 检查所有变更已提交
2. 确认提交信息符合规范
3. 确认 CHANGELOG.md 已更新
4. 评估是否需要创建 tag
5. 运行测试和检查

### Tag 创建时
1. 检查当前版本
2. 查看自上次 tag 以来的提交
3. 确定新版本号
4. 编写详细的 tag 注释
5. 创建发布文档
6. 更新版本控制历史

---

## 📊 规则优先级

1. **最高优先级** (⭐⭐⭐⭐⭐)
   - 文件组织规范
   - 版本控制规范
   - JSON 配置文件管理规范
   - 文档命名规范
   - 插件配置规范
   - 插件配置页面开发规范
   - 代码风格规范
   - 测试规范
   - Git 提交规范
   - 错误处理规范
   - **性能优化规范** ⭐ **NEW** - 性能优先于复杂度

---

## 🔗 相关文档

- [项目主文档](../CLAUDE.md) - Claude Code 指导文档
- [项目概览](../PROJECT_OVERVIEW.md) - 项目结构和特性
- [文档主索引](../../docs/MASTER_INDEX.md) - 所有文档的导航中心

---

## 📝 规则更新

- **v1.6.0** (2026-01-25) - 添加单一配置模式规范 ⭐ **NEW**
  - 核心原则：单一配置键存储所有持久化数据
  - 配置与临时状态分离：配置、数据、临时状态的区别
  - 配置键命名规范：`{plugin_id}_config` 格式
  - 配置模型设计：继承 `BasePluginSettings`，包含所有持久化数据
  - 插件实现模式：`initialize()`, `_saveConfig()`, `updateSettings()` 标准
  - 包含世界时钟、计算器、截图插件的完整参考实现
- **v1.5.0** (2026-01-24) - 添加配置响应式管理规范
  - 核心原则：配置修改必须立即生效，无需重启
  - 三种实现模式：ValueNotifier、didUpdateWidget、双向同步
  - 四种配置类型：UI 样式、功能开关、窗口 API、回调开关
  - 包含桌面宠物配置响应式完整案例
- **v1.4.0** (2026-01-22) - 添加性能优化规范，确立性能优先原则
  - 核心原则：性能优先于复杂度
  - Widget 优化：Listener vs GestureDetector
  - 状态管理：ValueNotifier/Stream/setState 选择指南
  - 包含 Desktop Pet 优化案例（90% 性能提升）
- **v1.3.0** (2026-01-20) - 添加插件配置规范和插件配置页面开发规范，修复格式错误
- **v1.2.0** (2026-01-20) - 添加文档命名规范
- **v1.1.0** (2026-01-19) - 添加 JSON 配置文件管理规范
- **v1.0.0** (2026-01-15) - 初始版本，创建文件组织和版本控制规则

---

**维护说明**: 当需要添加新的规则时，请在此文件中添加索引，并保持规则文档的一致性。

**版本**: v1.6.0
**最后更新**: 2026-01-25
