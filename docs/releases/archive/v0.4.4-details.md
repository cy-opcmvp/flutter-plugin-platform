# v0.4.4 è¯¦ç»†å½’æ¡£

**å‘å¸ƒæ—¥æœŸ**: 2026-01-25
**ç‰ˆæœ¬ç±»å‹**: Minorï¼ˆåŠŸèƒ½æ›´æ–°ï¼‰

---

## ğŸ“¦ å®Œæ•´åŠŸèƒ½åˆ—è¡¨

### æ–°å¢åŠŸèƒ½

#### 1. å¤–éƒ¨æ’ä»¶å›½é™…åŒ–æ”¯æŒç³»ç»Ÿï¼ˆIPluginI18nï¼‰

ä¸ºå¤–éƒ¨æ’ä»¶æä¾›å®Œæ•´çš„å›½é™…åŒ–æ”¯æŒç³»ç»Ÿï¼Œä½¿æ’ä»¶èƒ½å¤Ÿè½»æ¾å®ç°å¤šè¯­è¨€ç•Œé¢ã€‚

**IPluginI18n æ¥å£**ï¼ˆ`lib/core/interfaces/i_plugin_i18n.dart`ï¼‰ï¼š
- **translate** - é€šè¿‡é”®è·å–ç¿»è¯‘æ–‡æœ¬
- **translateLocale** - æŒ‡å®šè¯­è¨€è·å–ç¿»è¯‘
- **hasTranslation** - æ£€æŸ¥ç¿»è¯‘é”®æ˜¯å¦å­˜åœ¨
- **registerTranslations** - æ³¨å†Œæ’ä»¶çš„ç¿»è¯‘èµ„æº
- **getSupportedLanguages** - è·å–æ”¯æŒçš„è¯­è¨€åˆ—è¡¨

**PluginI18nHelper å®ç°**ï¼ˆ`lib/core/services/plugin_i18n_helper.dart`ï¼‰ï¼š
- æ”¯æŒå ä½ç¬¦æ›¿æ¢ï¼ˆ`{key}` æ ¼å¼ï¼‰
- è‡ªåŠ¨è¯­è¨€å›é€€æœºåˆ¶ï¼ˆzh_CN â†’ zh â†’ keyï¼‰
- ç¿»è¯‘èµ„æºåŠ¨æ€æ³¨å†Œå’ŒæŸ¥è¯¢
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

**ç³»ç»Ÿé›†æˆ**ï¼š
- æ›´æ–° `PluginContext`ï¼Œæ·»åŠ  `i18n` å­—æ®µ
- æ›´æ–° `PluginManager`ï¼Œåˆå§‹åŒ– i18n æœåŠ¡ï¼ˆåˆ›å»º LocaleProvider å’Œ PluginI18nHelperï¼‰
- æ›´æ–° `EnhancedPluginContext`ï¼Œæ”¯æŒ i18n å‚æ•°ä¼ é€’

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```dart
// æ³¨å†Œç¿»è¯‘
context.i18n.registerTranslations('com.example.plugin', {
  'zh': {'title': 'æˆ‘çš„æ’ä»¶'},
  'en': {'title': 'My Plugin'},
});

// ä½¿ç”¨ç¿»è¯‘
Text(i18n.translate('title'))

// å ä½ç¬¦æ›¿æ¢
Text(i18n.translate('greeting', args: {'name': 'John'}))
// è¾“å‡ºï¼šæ¬¢è¿ï¼ŒJohnï¼
```

---

#### 2. é…ç½®ç®¡ç†ç³»ç»Ÿæ–‡æ¡£

**æ–°å¢é…ç½®ç®¡ç†æŒ‡å—**ï¼ˆ`docs/guides/CONFIG_MANAGEMENT.md`ï¼‰ï¼š
- é…ç½®æ–‡ä»¶æ ¼å¼å’Œç»“æ„è¯´æ˜
- å…¨å±€é…ç½®å’Œæ’ä»¶é…ç½®ç®¡ç†æŒ‡å—
- é…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†è§„èŒƒ
- JSON Schema å®šä¹‰å’Œä½¿ç”¨

**æ–°å¢é…ç½®ç¤ºä¾‹æ–‡ä»¶**ï¼ˆ`assets/config/global_config.example.json`ï¼‰ï¼š
- å®Œæ•´çš„å…¨å±€é…ç½®ç»“æ„ç¤ºä¾‹
- åŒ…å«æ¡Œé¢å® ç‰©ã€æ’ä»¶é…ç½®ç­‰ç¤ºä¾‹
- æä¾›é…ç½®éªŒè¯è§„åˆ™å’Œè¯´æ˜

---

### æ”¹è¿›

#### 1. æ¡Œé¢å® ç‰©è®¾ç½®ä¼˜åŒ–

**è®¾ç½®ç•Œé¢æ”¹è¿›**ï¼ˆ`lib/ui/screens/desktop_pet_settings_screen.dart`ï¼‰ï¼š
- ä¼˜åŒ–å® ç‰©è®¾ç½®ç•Œé¢å¸ƒå±€
- æ”¹è¿›é…ç½®ç®¡ç†çš„å®æ—¶ä¿å­˜æœºåˆ¶
- å¢å¼ºç”¨æˆ·ä½“éªŒå’Œå“åº”æ€§

**é…ç½®ç®¡ç†ä¼˜åŒ–**ï¼š
- æ”¹è¿›é…ç½®çš„åŠ è½½å’Œä¿å­˜æµç¨‹
- ä¼˜åŒ–é…ç½®éªŒè¯é€»è¾‘
- ç¡®ä¿é…ç½®ä¿®æ”¹å³æ—¶ç”Ÿæ•ˆ

---

#### 2. æ’ä»¶é…ç½®ä¼˜åŒ–

ä¼˜åŒ–äº†å¤šä¸ªæ’ä»¶çš„é…ç½®ç•Œé¢ï¼š

- **è®¡ç®—å™¨æ’ä»¶**ï¼ˆ`lib/plugins/calculator/widgets/settings_screen.dart`ï¼‰ï¼š
  - ä¼˜åŒ–é…ç½®ç•Œé¢å¸ƒå±€
  - æ”¹è¿›é…ç½®æ§ä»¶äº¤äº’

- **ä¸–ç•Œæ—¶é’Ÿæ’ä»¶**ï¼ˆ`lib/plugins/world_clock/widgets/settings_screen.dart`ï¼‰ï¼š
  - æ”¹è¿›é…ç½®ç•Œé¢ç»“æ„
  - ä¼˜åŒ–é…ç½®é¡¹ç»„ç»‡

- **æˆªå›¾æ’ä»¶**ï¼ˆ`lib/plugins/screenshot/widgets/settings_screen.dart`ï¼‰ï¼š
  - ä¿®å¤é…ç½®ç›¸å…³é—®é¢˜
  - å®Œå–„é…ç½®éªŒè¯é€»è¾‘

---

### Bug ä¿®å¤

#### å›½é™…åŒ–é—®é¢˜ä¿®å¤ï¼ˆ7 ä¸ªç¼–è¯‘é”™è¯¯ï¼‰

1. **screenshot_main_widget.dart** - ä¿®å¤ `replaceAll` é”™è¯¯
   - **é—®é¢˜**ï¼šä½¿ç”¨ `replaceAll` å¤„ç†å‡½æ•°è¿”å›å€¼
   - **è§£å†³**ï¼šç›´æ¥è°ƒç”¨å›½é™…åŒ–å‡½æ•°ï¼ˆ`l10n.screenshot_minutes_ago(minutes)`ï¼‰

2. **_ScreenshotListItem** - ä¿®å¤ context è®¿é—®é—®é¢˜
   - **é—®é¢˜**ï¼šåœ¨ build æ–¹æ³•å¤–è®¿é—® context
   - **è§£å†³**ï¼šå°† l10n ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `_formatDate` æ–¹æ³•

3. **ç¿»è¯‘é”®ç¼ºå¤±** - æ·»åŠ  `common_add` ç¿»è¯‘
   - æ·»åŠ åˆ° `app_zh.arb`: "æ·»åŠ "
   - æ·»åŠ åˆ° `app_en.arb`: "Add"

4. **å¯¼å…¥è·¯å¾„ä¿®å¤** - ä¿®æ­£ `PluginI18nHelper` å¯¼å…¥è·¯å¾„

5. **æ„é€ å‡½æ•°æ›´æ–°** - æ›´æ–° `EnhancedPluginContext` æ”¯æŒ i18n å‚æ•°

6. **æœåŠ¡åˆå§‹åŒ–** - ä¿®å¤ `LocaleProvider` åˆå§‹åŒ–é—®é¢˜
   - **é—®é¢˜**ï¼šå°è¯•ä» ServiceLocator è·å–æœªæ³¨å†Œçš„ LocaleProvider
   - **è§£å†³**ï¼šç›´æ¥å®ä¾‹åŒ– `LocaleProvider()`

7. **ç¿»è¯‘æ–‡ä»¶ç”Ÿæˆ** - è¿è¡Œ `flutter gen-l10n` ç”Ÿæˆæœ€æ–°ç¿»è¯‘ä»£ç 

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ–°å¢æ–‡ä»¶ï¼ˆ4ä¸ªï¼‰

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `lib/core/interfaces/i_plugin_i18n.dart` | 76 | å¤–éƒ¨æ’ä»¶å›½é™…åŒ–æ¥å£å®šä¹‰ |
| `lib/core/services/plugin_i18n_helper.dart` | 129 | å›½é™…åŒ–è¾…åŠ©å®ç°ç±» |
| `assets/config/global_config.example.json` | - | å…¨å±€é…ç½®ç¤ºä¾‹æ–‡ä»¶ |
| `docs/guides/CONFIG_MANAGEMENT.md` | - | é…ç½®ç®¡ç†æŒ‡å— |

---

### ä¿®æ”¹æ–‡ä»¶ï¼ˆ23ä¸ªï¼‰

#### æ ¸å¿ƒç³»ç»Ÿ
- `lib/core/interfaces/i_plugin.dart` - æ·»åŠ  i18n å­—æ®µåˆ° PluginContext
- `lib/core/services/plugin_manager.dart` - åˆå§‹åŒ– i18n æœåŠ¡
- `lib/core/services/platform_services.dart` - æ›´æ–°æ„é€ å‡½æ•°

#### UI ç•Œé¢
- `lib/ui/screens/settings_screen.dart` - è®¾ç½®ç•Œé¢ä¼˜åŒ–
- `lib/ui/screens/desktop_pet_settings_screen.dart` - å® ç‰©è®¾ç½®ä¼˜åŒ–
- `lib/ui/screens/app_info_screen.dart` - åº”ç”¨ä¿¡æ¯ç•Œé¢æ›´æ–°

#### æ’ä»¶é…ç½®
- `lib/plugins/calculator/widgets/settings_screen.dart` - è®¡ç®—å™¨é…ç½®ä¼˜åŒ–
- `lib/plugins/world_clock/widgets/settings_screen.dart` - ä¸–ç•Œæ—¶é’Ÿé…ç½®ä¼˜åŒ–
- `lib/plugins/screenshot/widgets/settings_screen.dart` - æˆªå›¾é…ç½®ä¼˜åŒ–
- `lib/plugins/screenshot/widgets/screenshot_main_widget.dart` - å›½é™…åŒ–ä¿®å¤

#### å›½é™…åŒ–
- `lib/l10n/app_zh.arb` - æ·»åŠ  common_add ç¿»è¯‘
- `lib/l10n/app_en.arb` - æ·»åŠ  common_add ç¿»è¯‘
- `lib/l10n/generated/*` - è‡ªåŠ¨ç”Ÿæˆçš„ç¿»è¯‘ä»£ç 

#### æ–‡æ¡£
- `.claude/CLAUDE.md` - æ·»åŠ å¤–éƒ¨æ’ä»¶å›½é™…åŒ–æ”¯æŒç« èŠ‚
- `docs/guides/developer/external-plugin-development.md` - æ·»åŠ å®Œæ•´å›½é™…åŒ–æŒ‡å—ï¼ˆ380+ è¡Œï¼‰

---

### ä»£ç ç»Ÿè®¡

- **æ–‡ä»¶å˜æ›´**: 27 ä¸ªæ–‡ä»¶
- **æ–°å¢è¡Œæ•°**: +2,781
- **åˆ é™¤è¡Œæ•°**: -469
- **å‡€å¢é•¿**: +2,312 è¡Œ

---

## ğŸ“ å®Œæ•´æäº¤å†å²

- `44afdf0` - feat: å® ç‰©å’Œè®¾ç½®åŠŸèƒ½ä¼˜åŒ–ï¼Œå¤–éƒ¨æ’ä»¶å›½é™…åŒ–æ”¯æŒ
- `a9bbf64` - docs: æ›´æ–° CHANGELOG.mdï¼Œè®°å½• v0.4.4 ç‰ˆæœ¬å˜æ›´

**æäº¤èŒƒå›´**: 44afdf0..a9bbf64ï¼ˆ2 ä¸ªæäº¤ï¼‰

---

## âš ï¸ å·²çŸ¥é—®é¢˜

### ğŸ¾ å® ç‰©çª—å£èƒŒæ™¯é—ªçƒ

**æè¿°**: å½“å® ç‰©çª—å£ç¼©å°æ—¶ï¼Œä¼šæœ‰èƒŒæ™¯é—ªçƒç°è±¡

**å½±å“**: ç”¨æˆ·ä½“éªŒ

**è®¡åˆ’**: åœ¨ä¸‹ç‰ˆæœ¬ï¼ˆv0.4.5ï¼‰ä¸­ä¿®å¤

**ä¸´æ—¶æ–¹æ¡ˆ**: é¿å…é¢‘ç¹è°ƒæ•´å® ç‰©çª—å£å¤§å°

---

## ğŸ¯ ä¸‹ç‰ˆæœ¬è®¡åˆ’ï¼ˆv0.4.5ï¼‰

### ä¸»è¦ä»»åŠ¡

1. **éªŒè¯å’Œä¿®å¤å„æ’ä»¶çš„é…ç½®åŠŸèƒ½**
   - æµ‹è¯•æ‰€æœ‰æ’ä»¶çš„é…ç½®ä¿å­˜å’ŒåŠ è½½
   - ä¿®å¤é…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†é—®é¢˜
   - ä¼˜åŒ–é…ç½®ç•Œé¢çš„ç”¨æˆ·ä½“éªŒ

2. **ä¼˜åŒ–éƒ¨åˆ†æ’ä»¶åŠŸèƒ½**
   - æ€§èƒ½ä¼˜åŒ–
   - åŠŸèƒ½å¢å¼º
   - ç”¨æˆ·ç•Œé¢æ”¹è¿›

3. **ä¿®å¤å® ç‰©çª—å£ç¼©å°æ—¶èƒŒæ™¯é—ªçƒ**
   - è°ƒæŸ¥é—ªçƒåŸå› 
   - å®ç°ä¿®å¤æ–¹æ¡ˆ
   - æµ‹è¯•éªŒè¯

---

**å½’æ¡£æ—¶é—´**: 2026-01-25
**å½’æ¡£ç‰ˆæœ¬**: v0.4.4
**å½’æ¡£ç±»å‹**: è¯¦ç»†æŠ€æœ¯å½’æ¡£
