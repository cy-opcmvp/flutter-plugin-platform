<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{PLUGIN_NAME}}</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color, #ffffff);
            color: var(--text-color, #333333);
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { margin-bottom: 16px; }
        .description { color: #666; margin-bottom: 24px; }
        .card {
            background: var(--card-bg, #f5f5f5);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        button {
            background: var(--primary-color, #007bff);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { opacity: 0.9; }
        #output {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
            min-height: 100px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>{{PLUGIN_NAME}}</h1>
        <p class="description">{{PLUGIN_DESCRIPTION}}</p>
        
        <div class="card">
            <h3>操作</h3>
            <button onclick="testConnection()">测试连接</button>
            <button onclick="processData()">处理数据</button>
        </div>
        
        <div class="card">
            <h3>输出</h3>
            <div id="output">等待操作...</div>
        </div>
    </div>

    <script>
        const PLUGIN_ID = '{{PLUGIN_ID}}';
        const PLUGIN_VERSION = '1.0.0';
        
        // 插件 SDK 桥接
        const PluginSDK = {
            initialized: false,
            
            async initialize() {
                if (this.initialized) return;
                
                // 监听来自宿主的消息
                window.addEventListener('message', (event) => {
                    this.handleHostMessage(event.data);
                });
                
                // 报告就绪
                this.sendToHost({
                    type: 'ready',
                    pluginId: PLUGIN_ID,
                    version: PLUGIN_VERSION
                });
                
                this.initialized = true;
                log('Plugin initialized');
            },
            
            sendToHost(message) {
                if (window.parent !== window) {
                    window.parent.postMessage(message, '*');
                }
            },
            
            handleHostMessage(message) {
                const { type, data } = message;
                
                switch (type) {
                    case 'theme_changed':
                        this.applyTheme(data);
                        break;
                    case 'execute':
                        this.executeCommand(message);
                        break;
                }
            },
            
            applyTheme(theme) {
                document.documentElement.style.setProperty('--bg-color', theme.backgroundColor);
                document.documentElement.style.setProperty('--text-color', theme.textColor);
                document.documentElement.style.setProperty('--primary-color', theme.primaryColor);
            },
            
            async callHostAPI(method, params) {
                return new Promise((resolve, reject) => {
                    const messageId = Date.now().toString();
                    
                    const handler = (event) => {
                        if (event.data.messageId === messageId) {
                            window.removeEventListener('message', handler);
                            if (event.data.error) {
                                reject(new Error(event.data.error));
                            } else {
                                resolve(event.data.result);
                            }
                        }
                    };
                    
                    window.addEventListener('message', handler);
                    
                    this.sendToHost({
                        type: 'api_call',
                        messageId,
                        method,
                        params
                    });
                    
                    setTimeout(() => {
                        window.removeEventListener('message', handler);
                        reject(new Error('Timeout'));
                    }, 5000);
                });
            }
        };
        
        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        async function testConnection() {
            log('Testing connection...');
            try {
                const result = await PluginSDK.callHostAPI('ping', {});
                log(`Connection OK: ${JSON.stringify(result)}`);
            } catch (e) {
                log(`Connection failed: ${e.message}`);
            }
        }
        
        async function processData() {
            log('Processing data...');
            // TODO: 实现你的业务逻辑
            log('Data processed successfully');
        }
        
        // 初始化
        PluginSDK.initialize();
    </script>
</body>
</html>
